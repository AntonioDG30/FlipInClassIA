<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>FlipInClassIA - Dashboard</title>    <!-- Favicon -->    <link rel="shortcut icon" href="../static/dashboardStaticFile/img/svg/Logo.svg" type="image/x-icon">    <!-- Custom styles -->    <link rel="stylesheet" href="../static/dashboardStaticFile/css/style.min.css"></head><body><div class="layer"></div><!-- ! Body --><a class="skip-link sr-only" href="#skip-target">Skip to content</a><div class="page-flex">    <!-- ! Sidebar -->    {% include 'side-bar.html' %}    <div class="main-wrapper">        <!-- ! Main nav -->        {% include 'main-nav.html' %}        <!-- ! Main -->        <main class="main users chart-page" id="skip-target">            <div class="container">                <div class="row2">                    <div class="col-lg-9">                        <h2 class="main-title">{{ nome_corso }}</h2>                        <div id="calendar"></div>                        <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min.js"></script>                        <div class="users-table table-wrapper">                            <br>                            <table class="posts-table">                                <thead>                                <tr class="users-table-info">                                    <th>Data</th>                                    <th>Descrizione</th>                                    <th>Professore</th>                                    <th>Stato</th>                                    <th>Argomenti</th>                                </tr>                                </thead>                                <tbody>                                {% if calendario_lezioni : %}                                    {% for lezione in calendario_lezioni %}                                        <tr class>                                            <td>                                                {{ lezione['data'].strftime('%Y-%m-%d') }}                                            </td>                                            <td>                                                {{ lezione['descrizione'] }}                                            </td>                                            <td>                                                {{ lezione['nome'] + " " + lezione['cognome'] }}                                            </td>                                            <td>                                                <div class="table-cell">                                                    {% if lezione['data'] > oggi %}                                                        <span class="badge-active">Programmate</span>                                                    {% elif lezione['data'] == oggi %}                                                        <span class="badge-pending">Oggi</span>                                                    {% else %}                                                        <span class="badge-disabled">Passate</span>                                                    {% endif %}                                                </div>                                            </td>                                            <td><span class="toggle-icon">+</span></td>                                        </tr>                                        <tr class="hidden-row">                                            <td colspan="5">                                                {% for argomento in argomenti_lezioni %}                                                    {% if lezione['lezione_id'] == argomento['lezione_id'] %}                                                        {{ argomento['nome_argomento'] + " " }}                                                    {% endif %}                                                {% endfor %}                                            </td>                                        </tr>                                    {% endfor %}                                {% else %}                                    <td colspan="5">                                        Per questo corso non sono state programmate lezioni                                    </td>                                {% endif %}                                </tbody>                            </table>                        </div>                    </div>                </div>            </div>        </main>        <!-- ! Footer -->        {% include 'footerDash.html' %}    </div></div><!-- Chart library --><script src="../static/dashboardStaticFile/plugins/chart.min.js"></script><!-- Icons library --><script src="../static/dashboardStaticFile/plugins/feather.min.js"></script><!-- Custom scripts --><script src="../static/dashboardStaticFile/js/script.js"></script><script>    document.addEventListener("DOMContentLoaded", function () {        var toggles = document.querySelectorAll(".toggle-icon");        toggles.forEach(function (toggle) {            var icon = toggle;            var hiddenRow = toggle.closest("tr").nextElementSibling;            toggle.addEventListener("click", function () {                hiddenRow.classList.toggle("hidden-row");                icon.classList.toggle("rotate");            });        });    });</script><script>    // Funzione per creare elementi DOM    function createElement(tagName, className, innerText) {        var ele = document.createElement(tagName); // Crea un elemento DOM con il tag specificato        if (className) {            ele.className = className; // Aggiunge la classe specificata all'elemento, se fornita        }        if (innerText) {            ele.innerText = ele.textContent = innerText; // Imposta il testo interno dell'elemento, se fornito        }        return ele; // Ritorna l'elemento creato    }    // Funzione per ottenere i dati dal backend    async function fetchLezioni(corsoId) {        try {            const response = await fetch(`/api/lezioni?corso_id=${corsoId}`); // Effettua una richiesta al backend per ottenere le lezioni            if (!response.ok) {                throw new Error('Errore nel recupero delle lezioni'); // Lancia un errore se la risposta non è ok            }            return await response.json(); // Ritorna i dati in formato JSON        } catch (error) {            console.error('Errore:', error); // Logga l'errore sulla console            return []; // Ritorna un array vuoto in caso di errore        }    }    // Funzione per inizializzare il calendario    async function initializeCalendar(corsoId) {        const data = await fetchLezioni(corsoId); // Ottieni i dati dal backend        data.forEach(event => {            event.date = moment(event.date); // Assicura il formato corretto della data utilizzando moment.js        });        var calendar = new Calendar('#calendar', data); // Crea un nuovo calendario con i dati ottenuti    }    // Inizializza il calendario con il corso_id specifico    const corsoId = "{{ corso_id }}"; // Sostituisce con l'id del corso specifico    initializeCalendar(corsoId); // Chiama la funzione per inizializzare il calendario    // Definizione della classe Calendar    function Calendar(selector, events) {        this.el = document.querySelector(selector); // Seleziona l'elemento DOM in cui disegnare il calendario        this.events = events; // Memorizza gli eventi nel calendario        this.current = moment().date(1); // Imposta la data corrente al primo giorno del mese        this.draw(); // Disegna il calendario        var current = document.querySelector('.today'); // Cerca l'elemento corrente con la classe 'today'        if (current) {            var self = this;            window.setTimeout(function () {                self.openDay(current); // Apre il giorno corrente dopo un breve ritardo            }, 500);        }    }    // Metodo per disegnare il calendario    Calendar.prototype.draw = function () {        this.drawHeader(); // Disegna l'intestazione del calendario        this.drawMonth(); // Disegna il mese corrente        this.drawLegend(); // Disegna la legenda degli eventi    };    // Metodo per disegnare l'intestazione del calendario    Calendar.prototype.drawHeader = function () {        var self = this;        if (!this.header) { // Se l'intestazione non esiste già            this.header = createElement('div', 'header'); // Crea il div dell'intestazione            this.title = createElement('h1'); // Crea l'elemento titolo            var right = createElement('div', 'right'); // Crea il pulsante per andare al mese successivo            right.addEventListener('click', function () {                self.nextMonth(); // Aggiunge l'evento per passare al mese successivo            });            var left = createElement('div', 'left'); // Crea il pulsante per andare al mese precedente            left.addEventListener('click', function () {                self.prevMonth(); // Aggiunge l'evento per passare al mese precedente            });            this.header.appendChild(this.title); // Aggiunge il titolo all'intestazione            this.header.appendChild(right); // Aggiunge il pulsante destro all'intestazione            this.header.appendChild(left); // Aggiunge il pulsante sinistro all'intestazione            this.el.appendChild(this.header); // Aggiunge l'intestazione al calendario        }        this.title.innerHTML = this.current.format('MMMM YYYY'); // Imposta il titolo dell'intestazione con il mese e l'anno correnti    };    // Metodo per disegnare il mese corrente    Calendar.prototype.drawMonth = function () {        var self = this;        // Controlla se il mese esiste già e gestisce la rimozione per ridisegnarlo        if (this.month) {            this.oldMonth = this.month;            this.oldMonth.className = 'month out ' + (self.next ? 'next' : 'prev'); // Imposta la classe per animare l'uscita            this.oldMonth.addEventListener('animationend', function () {                self.oldMonth.parentNode.removeChild(self.oldMonth); // Rimuove il mese vecchio dopo l'animazione                self.month = createElement('div', 'month'); // Crea il nuovo mese                self.backFill(); // Riempie i giorni precedenti al primo giorno del mese                self.currentMonth(); // Disegna i giorni del mese corrente                self.forwardFill(); // Riempie i giorni successivi all'ultimo giorno del mese                self.el.appendChild(self.month); // Aggiunge il mese al calendario                window.setTimeout(function () {                    self.month.className = 'month in ' + (self.next ? 'next' : 'prev'); // Aggiunge la classe per animare l'entrata                }, 16);            });        } else {            this.month = createElement('div', 'month'); // Crea il nuovo mese se non esiste già            this.el.appendChild(this.month); // Aggiunge il mese al calendario            this.backFill(); // Riempie i giorni precedenti al primo giorno del mese            this.currentMonth(); // Disegna i giorni del mese corrente            self.forwardFill(); // Riempie i giorni successivi all'ultimo giorno del mese            this.month.className = 'month new'; // Aggiunge la classe per il mese appena creato        }    };    // Metodo per riempire i giorni precedenti al primo del mese corrente    Calendar.prototype.backFill = function () {        var clone = this.current.clone(); // Crea un clone della data corrente        var dayOfWeek = clone.day(); // Ottiene il giorno della settimana del primo giorno del mese        if (!dayOfWeek) {            return; // Se il primo giorno è una domenica, non serve riempire        }        clone.subtract(dayOfWeek + 1, 'days'); // Torna indietro di un numero di giorni per riempire        for (var i = dayOfWeek; i > 0; i--) {            this.drawDay(clone.add(1, 'days')); // Disegna ciascun giorno precedente        }    };    // Metodo per riempire i giorni successivi all'ultimo del mese corrente    Calendar.prototype.forwardFill = function () {        var clone = this.current.clone().add(1, 'months').subtract(1, 'days'); // Clona la data dell'ultimo giorno del mese        var dayOfWeek = clone.day(); // Ottiene il giorno della settimana dell'ultimo giorno del mese        if (dayOfWeek === 6) {            return; // Se l'ultimo giorno è un sabato, non serve riempire        }        for (var i = dayOfWeek; i < 6; i++) {            this.drawDay(clone.add(1, 'days')); // Disegna ciascun giorno successivo        }    };    // Metodo per disegnare i giorni del mese corrente    Calendar.prototype.currentMonth = function () {        var clone = this.current.clone(); // Crea un clone della data corrente        while (clone.month() === this.current.month()) {            this.drawDay(clone); // Disegna ciascun giorno finché il mese è lo stesso            clone.add(1, 'days'); // Passa al giorno successivo        }    };    // Metodo per ottenere la settimana corrente e crearne una nuova se necessario    Calendar.prototype.getWeek = function (day) {        if (!this.week || day.day() === 0) { // Se non esiste una settimana o il giorno è domenica            this.week = createElement('div', 'week'); // Crea un nuovo div per la settimana            this.month.appendChild(this.week); // Aggiunge la settimana al mese        }    };    // Metodo per disegnare un giorno specifico    Calendar.prototype.drawDay = function (day) {        var self = this;        this.getWeek(day); // Ottiene o crea la settimana corrente        var outer = createElement('div', this.getDayClass(day)); // Crea il div esterno del giorno con le classi appropriate        outer.addEventListener('click', function () {            self.openDay(this); // Aggiunge l'evento per aprire il giorno selezionato        });        var name = createElement('div', 'day-name', day.format('ddd')); // Crea il div per il nome del giorno (es. lun)        var number = createElement('div', 'day-number', day.format('DD')); // Crea il div per il numero del giorno        var events = createElement('div', 'day-events'); // Crea il div per gli eventi del giorno        this.drawEvents(day, events); // Disegna gli eventi del giorno        outer.appendChild(name); // Aggiunge il nome del giorno al div esterno        outer.appendChild(number); // Aggiunge il numero del giorno al div esterno        outer.appendChild(events); // Aggiunge gli eventi al div esterno        this.week.appendChild(outer); // Aggiunge il div del giorno alla settimana    };    // Metodo per disegnare gli eventi di un giorno specifico    Calendar.prototype.drawEvents = function (day, element) {        if (day.month() === this.current.month()) { // Se il giorno è nel mese corrente            var todaysEvents = this.events.reduce(function (memo, ev) {                if (ev.date.isSame(day, 'day')) { // Verifica se l'evento corrisponde al giorno corrente                    memo.push(ev); // Aggiunge l'evento alla lista degli eventi del giorno                }                return memo;            }, []);            todaysEvents.forEach(function (ev) {                var evSpan = createElement('span', ev.color); // Crea un elemento span per ogni evento con il colore appropriato                element.appendChild(evSpan); // Aggiunge lo span al div degli eventi            });        }    };    // Metodo per ottenere le classi CSS appropriate per un giorno specifico    Calendar.prototype.getDayClass = function (day) {        var classes = ['day']; // Classe di base per tutti i giorni        if (day.month() !== this.current.month()) {            classes.push('other'); // Aggiunge la classe 'other' se il giorno non è nel mese corrente        } else if (moment().isSame(day, 'day')) {            classes.push('today'); // Aggiunge la classe 'today' se il giorno è oggi        }        return classes.join(' '); // Ritorna le classi unite come stringa    };    // Metodo per aprire il dettaglio di un giorno selezionato    Calendar.prototype.openDay = function (el) {        var details, arrow;        var dayNumber = +el.querySelectorAll('.day-number')[0].innerText || +el.querySelectorAll('.day-number')[0].textContent; // Ottiene il numero del giorno        var day = this.current.clone().date(dayNumber); // Crea una data clone impostata sul giorno selezionato        var currentOpened = document.querySelector('.details'); // Verifica se c'è già un dettaglio aperto        if (currentOpened && currentOpened.parentNode === el.parentNode) { // Se c'è già un dettaglio aperto nello stesso giorno            details = currentOpened; // Riassegna il dettaglio aperto            arrow = document.querySelector('.arrow'); // Trova la freccia per il dettaglio        } else {            if (currentOpened) { // Se c'è un dettaglio aperto in un altro giorno                currentOpened.addEventListener('animationend', function () {                    currentOpened.parentNode.removeChild(currentOpened); // Rimuove il dettaglio aperto dopo l'animazione                });                currentOpened.className = 'details out'; // Anima l'uscita del dettaglio            }            details = createElement('div', 'details in'); // Crea un nuovo div per i dettagli del giorno            arrow = createElement('div', 'arrow'); // Crea la freccia            details.appendChild(arrow); // Aggiunge la freccia al dettaglio            el.parentNode.appendChild(details); // Aggiunge il dettaglio al giorno selezionato        }        var todaysEvents = this.events.reduce(function (memo, ev) {            if (ev.date.isSame(day, 'day')) { // Verifica se l'evento corrisponde al giorno selezionato                memo.push(ev); // Aggiunge l'evento alla lista degli eventi del giorno            }            return memo;        }, []);        this.renderEvents(todaysEvents, details); // Disegna gli eventi del giorno nel dettaglio        arrow.style.left = el.offsetLeft - el.parentNode.offsetLeft + 27 + 'px'; // Posiziona la freccia nel dettaglio    };    // Metodo per disegnare gli eventi in un elemento specifico    Calendar.prototype.renderEvents = function (events, ele) {        var currentWrapper = ele.querySelector('.events'); // Cerca un wrapper esistente per gli eventi        var wrapper = createElement('div', 'events in' + (currentWrapper ? ' new' : '')); // Crea un nuovo wrapper per gli eventi        events.forEach(function (ev) { // Per ogni evento            var div = createElement('div', 'event'); // Crea un div per l'evento            var square = createElement('div', 'event-category ' + ev.color); // Crea un quadrato colorato per l'evento            var span = createElement('span', '', ev.descrizione); // Crea uno span con il nome dell'evento            div.appendChild(square); // Aggiunge il quadrato all'evento            div.appendChild(span); // Aggiunge il nome all'evento            wrapper.appendChild(div); // Aggiunge l'evento al wrapper        });        if (!events.length) { // Se non ci sono eventi            var div = createElement('div', 'event empty'); // Crea un div per indicare che non ci sono eventi            var span = createElement('span', '', 'No Events'); // Aggiunge il testo "No Events"            div.appendChild(span); // Aggiunge lo span al div            wrapper.appendChild(div); // Aggiunge il div al wrapper        }        if (currentWrapper) { // Se c'è già un wrapper per gli eventi            currentWrapper.className = 'events out'; // Anima l'uscita del vecchio wrapper            currentWrapper.addEventListener('animationend', function () {                currentWrapper.parentNode.removeChild(currentWrapper); // Rimuove il vecchio wrapper dopo l'animazione                ele.appendChild(wrapper); // Aggiunge il nuovo wrapper            });        } else {            ele.appendChild(wrapper); // Aggiunge il nuovo wrapper        }    };    // Metodo per disegnare la legenda degli eventi    Calendar.prototype.drawLegend = function () {        var legend = createElement('div', 'legend'); // Crea un div per la legenda        var calendars = this.events.map(function (e) {            return e.calendar + '|' + e.color; // Crea una lista di calendari e colori dagli eventi        }).reduce(function (memo, e) {            if (memo.indexOf(e) === -1) { // Rimuove i duplicati                memo.push(e);            }            return memo;        }, []).forEach(function (e) {            var parts = e.split('|'); // Divide il calendario e il colore            var entry = createElement('span', 'entry ' + parts[1], parts[0]); // Crea un elemento della legenda            legend.appendChild(entry); // Aggiunge l'elemento alla legenda        });        this.el.appendChild(legend); // Aggiunge la legenda al calendario    };    // Metodo per passare al mese successivo    Calendar.prototype.nextMonth = function () {        this.current.add(1, 'months'); // Aggiunge un mese alla data corrente        this.next = true; // Imposta la variabile per indicare il passaggio al mese successivo        this.draw(); // Ridisegna il calendario    };    // Metodo per tornare al mese precedente    Calendar.prototype.prevMonth = function () {        this.current.subtract(1, 'months'); // Sottrae un mese alla data corrente        this.next = false; // Imposta la variabile per indicare il passaggio al mese precedente        this.draw(); // Ridisegna il calendario    };    // Assegna la classe Calendar alla finestra globale per essere accessibile dall'esterno    window.Calendar = Calendar;</script></body></html>